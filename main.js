(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),document.addEventListener("click",n),document.addEventListener("keydown",o)}function e(t){t.classList.remove("popup_is-opened"),document.removeEventListener("click",n),document.removeEventListener("keydown",o)}function n(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup"))&&e(document.querySelector(".popup_is-opened"))}function o(t){"Escape"===t.key&&e(document.querySelector(".popup_is-opened"))}var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"aefb9d6c-0be1-424f-9825-78d813242522","Content-Type":"application/json"}};function c(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function a(e,n,o,r,c,a,i,u,l,s){var d=document.querySelector("#card-template").content.cloneNode("#card-template"),p=d.querySelector(".card__like-button"),f=d.querySelector(".card__image"),m=d.querySelector(".card__title"),_=d.querySelector(".card__delete-button"),h=document.createElement("div"),y=d.querySelector(".card__likes-container"),v=d.querySelector(".places__item");return m.textContent=e,f.src=n,f.alt=e,v.setAttribute("id","".concat(i)),u&&p.classList.toggle("card__like-button_is-active"),c&&(h.textContent=c,y.append(h)),a&&(_.style.display="inline-block"),_.addEventListener("click",(function(e){t(l);var n=e.target.closest("li").getAttribute("id");s.setAttribute("data-card-to-delete-id","".concat(n))})),f.addEventListener("click",o),p.addEventListener("click",(function(t){return r(t,i,h,y)})),d}function i(t,e,n,o){t.target.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:r.headers}).then(c).catch((function(t){console.log(t)}))}(e).then((function(e){t.target.classList.toggle("card__like-button_is-active"),0===e.likes.length&&n.remove(),n.textContent=e.likes.length})).catch((function(t){console.log(t)})):function(t){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:r.headers}).then(c).catch((function(t){console.log(t)}))}(e).then((function(e){t.target.classList.toggle("card__like-button_is-active"),1===e.likes.length&&o.append(n),n.textContent=e.likes.length})).catch((function(t){console.log(t)}))}function u(t,e,n){e.classList.remove(n),t.textContent=""}function l(t,e,n,o){var r=t.querySelector(".".concat(n));!function(t,e){return Array.from(t.querySelectorAll(".".concat(e))).some((function(t){if(!t.validity.valid)return!0}))}(t,o)?(r.classList.remove(e),r.removeAttribute("disabled","")):(r.classList.add(e),r.setAttribute("disabled",""))}function s(t,e){l(t,e.inactiveButtonClass,e.submitButtonSelector,e.inputSelector),t.querySelectorAll(".".concat(e.inputSelector)).forEach((function(n){u(t.querySelector(".".concat(n.id,"-error")),n,e.inputErrorClass)}))}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var p,f,m,_=document.querySelector(".places__list"),h=document.forms["edit-profile"],y=document.forms["new-avatar"],v=y.link,g=h.name,b=h.description,S=document.querySelector(".profile__image"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),L=document.forms["new-place"],q=L["place-name"],C=L.link,A=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button"),T=document.querySelector(".popup_type_edit"),w=document.querySelector(".popup_type_new-card"),U=document.querySelector(".popup_type_image"),j=document.querySelector(".popup__caption"),O=document.querySelector(".popup__image"),P=document.querySelector(".popup_type_new-avatar"),B=document.querySelector(".popup_type_delete-confirm"),D=document.querySelector(".popup__button_delete-confirm"),M={formSelector:"popup__form",inputSelector:"popup__input",submitButtonSelector:"popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_invalid",errorClass:"popup__input-error"};function I(e){O.src=e.target.src,O.alt=e.target.alt,j.textContent=e.target.alt,t(U)}function N(t){var e=t.target.querySelector(".popup__button_loading-text"),n=t.target.querySelector(".popup__button_initial-text");e.classList.toggle("popup_button_text-is-visible"),n.classList.toggle("popup_button_text-is-visible")}D.addEventListener("click",(function(t){var n=t.target.getAttribute("data-card-to-delete-id"),o=document.getElementById("".concat(n));(function(t){return fetch("".concat(r.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:r.headers})})(n).then((function(t){if(!t.ok)return Promise.reject("Ошибка: ".concat(t.status));o.remove(),e(B)})).catch((function(t){console.log(t)}))})),_.addEventListener("click",(function(e){e.target.classList.contains("card__image")&&t(U)})),S.addEventListener("click",(function(){s(y,M),y.reset(),t(P)})),A.addEventListener("click",(function(){g.value=k.textContent,b.value=E.textContent,s(h,M),t(T)})),x.addEventListener("click",(function(){t(w),L.reset(),s(L,M)})),y.addEventListener("submit",(function(t){t.preventDefault(),N(t),function(t){return fetch("".concat(t),{method:"HEAD"})}(v.value).then((function(t){if(!t.ok||!t.headers.get("Content-Type").startsWith("image"))return Promise.reject({errorMessage:"Ошибка в isUrlExist ".concat(t.status),mimeType:t.headers.get("Content-Type")});(function(t){return fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:"".concat(t)})}).then(c).catch((function(t){console.log(t)}))})(t.url).then((function(t){S.setAttribute("style","background-image: url('".concat(t.avatar,"')")),e(P)}))})).catch((function(t){console.log(t.errorMessage),t.mimeType.startsWith("image")||console.log("По указанному Url не изображение")})).finally((function(){return N(t)}))})),h.addEventListener("submit",(function(t){!function(t){var n,o;N(t),(n=g.value,o=b.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:"".concat(n),about:"".concat(o)})}).then(c).catch((function(t){console.log(t)}))).then((function(t){k.textContent=t.name,E.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){return N(t)})),t.preventDefault(),e(T)}(t)})),L.addEventListener("submit",(function(t){!function(t){var n,o;N(t),(n=q.value,o=C.value,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:"".concat(n),link:"".concat(o)})}).then(c).catch((function(t){console.log(t)}))).then((function(t){f=p===t.owner._id;var e=t._id,n=a(t.name,t.link,I,i,0,f,e,!1,B,D);_.prepend(n)})).catch((function(t){console.log(t)})).finally((function(){return N(t)})),t.target.reset(),t.preventDefault(),e(w)}(t)})),m=M,document.querySelectorAll(".".concat(m.formSelector)).forEach((function(t){!function(t,e,n,o,r){t.querySelectorAll(".".concat(n)).forEach((function(c){return c.addEventListener("input",(function(){!function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.validity.valid?u(o,e,n):function(t,e,n){e.classList.add(n),e.validity.patternMismatch?e.setCustomValidity(e.getAttribute("data-error-message")):e.setCustomValidity(""),t.textContent=e.validationMessage}(o,e,n)}(t,c,e),l(t,o,r,n)}))}))}(t,m.inputErrorClass,m.inputSelector,m.inactiveButtonClass,m.submitButtonSelector)})),Promise.all([fetch("".concat(r.baseUrl,"/users/me"),{method:"GET",headers:r.headers}).then(c).catch((function(t){console.log(t)})),fetch("".concat(r.baseUrl,"/cards"),{method:"GET",headers:r.headers}).then(c).catch((function(t){console.log(t)}))]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];p=r._id,k.textContent=r.name,E.textContent=r.about,S.setAttribute("style","background-image: url('".concat(r.avatar,"')")),c.forEach((function(t){f=p===t.owner._id;var e=t.likes.some((function(t){return t._id===p}));_.append(a(t.name,t.link,I,i,t.likes.length,f,t._id,e,B,D))}))})).catch((function(t){console.log(t)}))})();
//# sourceMappingURL=main.js.map